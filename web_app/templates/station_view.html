{% extends "base.html" %}
{% block title %}{{ id }}{% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        .important {
            color: #336699;
        }

        .wrapper {
            display: grid;
            grid-template-rows: 8% 92%;
            grid-template-columns: 50% 25% 25%;
            width: 100vw;
            height: 100vh;
        }

        .head {
            grid-column: 1/-1;
        }


        .svg_map {
            height: 100%;
            width: 100%;
            background-color: #AEAEAE;
        }

        .map {
            background-color: #666;
            grid-row: 2;
            grid-column: 1;
        }

        .input {
            background-color: #555;
            grid-row: 2;
            grid-column: 2;
        }

        .output {
            background-color: #666;
            grid-row: 2;
            grid-column: 3;
        }

        .sphere {
            fill: #AEAEAE;
        }

        .land {
            fill: #858585;
        }

        .boundary {
            fill: none;
            stroke: #333;
            stroke-linejoin: round;
            stroke-linecap: round;
            vector-effect: non-scaling-stroke;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="wrapper">
        <div class="w3-container w3-blue-grey head">
            <h1>{{ id }}</h1>
        </div>

        <div class="map">
            <svg id="svg_map" width="100%" height="100%"></svg>
        </div>

        <div class="input">
        </div>

        <div class="output">
        </div>

    </div>

    <script>
        const projection = d3.geoAzimuthalEqualArea();
        const path = d3.geoPath().projection(projection);

        const zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on('zoom', zoomed);

        const svg = d3.select('#svg_map');

        const g = svg.append('g');
        d3.select('g').attr('transform', 'translate(0 0)')
        {#d3.select('g').attr('transform', 'translate(0,0)')#}
        svg.style("width", "100%");
        g.call(zoom);


        d3.json("{{ url_for('static', filename='world-110m2.json') }}")
            .then(world => {
                g.append('path')
                    .datum({type: 'Sphere'})
                    .attr('class', 'sphere')
                    .attr('d', path);

                g.append('path')
                    .datum(topojson.merge(world, world.objects.countries.geometries))
                    .attr('class', 'land')
                    .attr('d', path);

                g.append('path')
                    .datum(topojson.mesh(world, world.objects.countries, (a, b) => a !== b))
                    .attr('class', 'boundary')
                    .attr('d', path);
            });

        function zoomed() {
            g
                .selectAll('path') // To prevent stroke width from scaling
                .attr('transform', d3.event.transform);
            g
                .selectAll('circle') // To prevent stroke width from scaling
                .attr('transform', d3.event.transform).attr("r", Math.min(3, 3 / (d3.event.transform.k / 2)));
        }
    </script>
{% endblock %}